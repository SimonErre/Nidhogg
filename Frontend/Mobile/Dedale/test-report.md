# Rapport de tests unitaires

| n°  | Fichier testé                 | Fonction testée             | Nom du test                                                             | Variables                                                      | Résultat attendu                                                      | Résultat reçu                                                         | Test validé ? |
| --- | ----------------------------- | --------------------------- | ----------------------------------------------------------------------- | -------------------------------------------------------------- | --------------------------------------------------------------------- | --------------------------------------------------------------------- | ------------- |
| 1   | PointDetails.test.tsx         | savePointToDB (persistence) | sauvegarde complète avec commentaire, images et obstacles               | selectedEventId, selectedImages, selectedObstacles, location   | Insertion SQL point, images, obstacles                                | Insertion SQL point, images, obstacles                                | Oui           |
| 2   | PointDetails.test.tsx         | savePointToDB (persistence) | sauvegarde minimale sans images ni obstacles                            | selectedEventId, location                                      | Insertion SQL point uniquement                                        | Insertion SQL point uniquement                                        | Oui           |
| 3   | PointDetails.test.tsx         | savePointToDB (persistence) | échec image n’empêche pas la sauvegarde du point                        | selectedEventId, location, image                               | Point inséré même si image échoue                                     | Point inséré même si image échoue                                     | Oui           |
| 4   | RegisterPointScreen.test.tsx  | savePointToDB (persistence) | sauvegarde complète avec commentaire, images et obstacles               | selectedEventId, selectedImages, selectedObstacles, location   | Insertion SQL point, images, obstacles                                | Insertion SQL point, images, obstacles                                | Oui           |
| 5   | RegisterPointScreen.test.tsx  | savePointToDB (persistence) | sauvegarde minimale sans images ni obstacles                            | selectedEventId, location                                      | Insertion SQL point uniquement                                        | Insertion SQL point uniquement                                        | Oui           |
| 6   | RegisterPointScreen.test.tsx  | savePointToDB (persistence) | échec image n’empêche pas la sauvegarde du point                        | selectedEventId, location, image                               | Point inséré même si image échoue                                     | Point inséré même si image échoue                                     | Oui           |
| 7   | PlanningScreen.test.tsx       | PlanningScreen              | should render team info and actions list correctly                      | mockGetFirstSync, mockGetAllSync                               | Affichage équipe et actions                                           | Affichage équipe et actions                                           | Oui           |
| 8   | PlanningScreen.test.tsx       | PlanningScreen              | should navigate to TeamGuidance when clicking start button              | mockNavigate                                                   | Navigation vers TeamGuidance                                          | Navigation vers TeamGuidance                                          | Oui           |
| 9   | PlanningScreen.test.tsx       | PlanningScreen              | should toggle QR Scanner                                                | mockGetFirstSync, mockGetAllSync                               | Affichage scanner QR                                                  | Affichage scanner QR                                                  | Oui           |
| 10  | PlanningScreen.test.tsx       | PlanningScreen              | should handle empty state (no team found)                               | mockGetFirstSync                                               | Affichage message "Aucune équipe"                                     | Affichage message "Aucune équipe"                                     | Oui           |
| 11  | ObstacleSelector.test.tsx     | ObstacleSelector            | should render nothing if not visible                                    | visible=false                                                  | Rien affiché                                                          | Rien affiché                                                          | Oui           |
| 12  | ObstacleSelector.test.tsx     | ObstacleSelector            | should load types and handle selection logic (increment/decrement)      | mockGetAllSync, plus/minus buttons                             | Sélection et validation obstacles                                     | Sélection et validation obstacles                                     | Oui           |
| 13  | ObstacleSelector.test.tsx     | ObstacleSelector            | should initialize with pre-selected obstacles                           | initialObstacles                                               | Affichage du nombre pré-sélectionné                                   | Affichage du nombre pré-sélectionné                                   | Oui           |
| 14  | WebSocketClient.test.ts       | WebSocketClient             | Se connecte et reçoit des messages JSON valides                         | onMessageMock                                                  | Réception des messages                                                | Réception des messages                                                | Oui           |
| 15  | WebSocketClient.test.ts       | WebSocketClient             | Gère le message spécial "fini"                                          | onFinishedMock                                                 | Callback appelé                                                       | Callback appelé                                                       | Oui           |
| 16  | WebSocketClient.test.ts       | WebSocketClient             | Envoie des données correctement                                         | send                                                           | Données envoyées                                                      | Données envoyées                                                      | Oui           |
| 17  | WebSocketClient.test.ts       | WebSocketClient             | Détecte une erreur de connexion                                         | connect                                                        | Erreur détectée                                                       | Erreur détectée                                                       | Oui           |
| 18  | Map.test.ts                   | parseWKT                    | Parse correctement un POINT                                             | wkt                                                            | Objet point                                                           | Objet point                                                           | Oui           |
| 19  | Map.test.ts                   | parseWKT                    | Parse correctement une LINESTRING                                       | wkt                                                            | Objet linestring                                                      | Objet linestring                                                      | Oui           |
| 20  | Map.test.ts                   | parseWKT                    | Parse correctement un POLYGON                                           | wkt                                                            | Objet polygon                                                         | Objet polygon                                                         | Oui           |
| 21  | Map.test.ts                   | parseWKT                    | Retourne null pour un WKT invalide                                      | wkt                                                            | null                                                                  | null                                                                  | Oui           |
| 22  | Map.test.ts                   | parseWKT                    | Retourne null pour une chaîne vide                                      | wkt                                                            | null                                                                  | null                                                                  | Oui           |
| 23  | InterestPointsScreen.test.tsx | InterestPointsScreen        | should render loading state                                             | mockLoading=true                                               | Affichage "Chargement des points..."                                  | Affichage "Chargement des points..."                                  | Oui           |
| 24  | InterestPointsScreen.test.tsx | InterestPointsScreen        | should render empty state                                               | mockPointsData=[]                                              | Affichage "Aucun point"                                               | Affichage "Aucun point"                                               | Oui           |
| 25  | InterestPointsScreen.test.tsx | InterestPointsScreen        | should render list sorted by recent by default                          | mockPointsData                                                 | Ordre: récent d'abord                                                 | Ordre: récent d'abord                                                 | Oui           |
| 26  | InterestPointsScreen.test.tsx | InterestPointsScreen        | should sort by distance                                                 | mockPointsData, fireEvent                                      | Ordre: plus proche d'abord                                            | Ordre: plus proche d'abord                                            | Oui           |
| 27  | InterestPointsScreen.test.tsx | InterestPointsScreen        | should navigate to details                                              | mockNavigate, fireEvent                                        | Navigation vers PointDetails                                          | Navigation vers PointDetails                                          | Oui           |
| 28  | ConnectEvent.test.tsx         | ConnectEvent                | should render empty state correctly                                     | mockEventsReturn=[]                                            | Affichage "Sélectionner un événement" et "Aucun événement disponible" | Affichage "Sélectionner un événement" et "Aucun événement disponible" | Oui           |
| 29  | ConnectEvent.test.tsx         | ConnectEvent                | should render a list of events                                          | mockEventsReturn                                               | Affichage des événements                                              | Affichage des événements                                              | Oui           |
| 30  | ConnectEvent.test.tsx         | ConnectEvent                | should toggle QR Scanner view                                           | fireEvent                                                      | Affichage scanner QR                                                  | Affichage scanner QR                                                  | Oui           |
| 31  | ConnectEvent.test.tsx         | ConnectEvent                | should handle event selection: fetch stats, set context, and navigate   | mockSetSelectedEventId, mockNavigate, fireEvent                | Sélection, navigation, stats                                          | Sélection, navigation, stats                                          | Oui           |
| 32  | ConnectEvent.test.tsx         | sortEventsByStatus          | should sort events by priority: actif > planifié > passé                | mixedEvents                                                    | Ordre: actif, planifié, passé, autre                                  | Ordre: actif, planifié, passé, autre                                  | Oui           |
| 33  | ConnectEvent.test.tsx         | sortEventsByStatus          | should handle missing status gracefully                                 | events                                                         | Actif en premier, puis sans statut                                    | Actif en premier, puis sans statut                                    | Oui           |
| 34  | ImageHelper.test.ts           | imageToBase64               | should convert file uri to base64 string                                | fakeUri, fakeBase64                                            | Conversion en base64                                                  | Conversion en base64                                                  | Oui           |
| 35  | ImageHelper.test.ts           | saveImageToBDD              | should convert image, generate ID and insert into DB                    | fakeUri, pointId, fakeBase64, fakeUuid                         | Insertion image en DB                                                 | Insertion image en DB                                                 | Oui           |
| 36  | ImageHelper.test.ts           | saveImageToBDD              | should throw error if database fails                                    | db.runSync throw                                               | Erreur levée, log                                                     | Erreur levée, log                                                     | Oui           |
| 37  | ImageHelper.test.ts           | pickImage                   | should return URI if permission granted and photo taken                 | permission granted, photo taken                                | Retourne URI photo                                                    | Retourne URI photo                                                    | Oui           |
| 38  | ImageHelper.test.ts           | pickImage                   | should alert and return undefined if permission denied                  | permission denied                                              | Alert affichée, undefined                                             | Alert affichée, undefined                                             | Oui           |
| 39  | ImageHelper.test.ts           | pickImage                   | should return undefined if user cancels camera                          | canceled=true                                                  | Retourne undefined                                                    | Retourne undefined                                                    | Oui           |
| 40  | ImageHelper.test.ts           | pickImage                   | should handle errors and show alert                                     | camera error                                                   | Alert affichée, log                                                   | Alert affichée, log                                                   | Oui           |
| 41  | Helper.test.ts                | generateUUID                | should generate a valid UUID v4 format                                  | -                                                              | UUID v4 valide                                                        | UUID v4 valide                                                        | Oui           |
| 42  | Helper.test.ts                | generateUUID                | should generate unique values                                           | -                                                              | UUIDs différents                                                      | UUIDs différents                                                      | Oui           |
| 43  | Helper.test.ts                | shortId                     | should return first 8 chars of a long string                            | longId                                                         | 8 premiers caractères                                                 | 8 premiers caractères                                                 | Oui           |
| 44  | Helper.test.ts                | shortId                     | should return empty string if input is falsy                            | ''                                                             | ''                                                                    | ''                                                                    | Oui           |
| 45  | Helper.test.ts                | calculateDistance           | should calculate correct euclidean distance                             | x1, y1, x2, y2                                                 | Distance correcte                                                     | Distance correcte                                                     | Oui           |
| 46  | Helper.test.ts                | calculateDistance           | should return 0 for same points                                         | x1, y1, x2, y2                                                 | 0                                                                     | 0                                                                     | Oui           |
| 47  | Helper.test.ts                | getUserLocation             | should return coordinates if permission granted                         | permission granted                                             | Coordonnées                                                           | Coordonnées                                                           | Oui           |
| 48  | Helper.test.ts                | getUserLocation             | should alert and return null if permission denied                       | permission denied                                              | Alert, null                                                           | Alert, null                                                           | Oui           |
| 49  | Helper.test.ts                | getAddressFromCoords        | should format address correctly when all fields exist                   | fields exist                                                   | Adresse formatée                                                      | Adresse formatée                                                      | Oui           |
| 50  | Helper.test.ts                | getAddressFromCoords        | should handle missing fields gracefully                                 | fields missing                                                 | Adresse partielle                                                     | Adresse partielle                                                     | Oui           |
| 51  | Helper.test.ts                | getAddressFromCoords        | should return null and log error on failure                             | reverseGeocodeAsync error                                      | null, log                                                             | null, log                                                             | Oui           |
| 52  | databaseAcces.test.ts         | updateComment               | updateComment should execute correct SQL                                | pointId, newValue                                              | SQL UPDATE exécuté                                                    | SQL UPDATE exécuté                                                    | Oui           |
| 53  | databaseAcces.test.ts         | deleteComment               | deleteComment should set comment to NULL                                | pointId                                                        | SQL UPDATE exécuté                                                    | SQL UPDATE exécuté                                                    | Oui           |
| 54  | databaseAcces.test.ts         | addComment                  | addComment should execute update SQL and return result                  | pointId, value, mockResult                                     | SQL UPDATE exécuté, retourne résultat                                 | SQL UPDATE exécuté, retourne résultat                                 | Oui           |
| 55  | databaseAcces.test.ts         | addPicture                  | addPicture should generate UUID and INSERT                              | pointId, imageBase64, uuid-pic-1                               | SQL INSERT exécuté                                                    | SQL INSERT exécuté                                                    | Oui           |
| 56  | databaseAcces.test.ts         | updatePicture               | updatePicture should execute UPDATE                                     | picId, newImg                                                  | SQL UPDATE exécuté                                                    | SQL UPDATE exécuté                                                    | Oui           |
| 57  | databaseAcces.test.ts         | deletePicture               | deletePicture should execute DELETE                                     | picId                                                          | SQL DELETE exécuté                                                    | SQL DELETE exécuté                                                    | Oui           |
| 58  | databaseAcces.test.ts         | addEquipement               | addEquipement without coordinates should insert only equipement         | eventId, typeId, quantity, uuid-eq-1                           | SQL INSERT exécuté                                                    | SQL INSERT exécuté                                                    | Oui           |
| 59  | databaseAcces.test.ts         | addEquipement               | addEquipement with coordinates should insert equipement AND coordinates | eventId, typeId, coords, uuid-eq-1, uuid-coord-1, uuid-coord-2 | SQL INSERTs exécutés                                                  | SQL INSERTs exécutés                                                  | Oui           |
| 60  | databaseAcces.test.ts         | updateEquipement            | updateEquipement should execute UPDATE                                  | eq-1, 10, 2                                                    | SQL UPDATE exécuté                                                    | SQL UPDATE exécuté                                                    | Oui           |
| 61  | databaseAcces.test.ts         | deleteEquipement            | deleteEquipement should execute DELETE                                  | eq-1                                                           | SQL DELETE exécuté                                                    | SQL DELETE exécuté                                                    | Oui           |
| 62  | databaseAcces.test.ts         | updatePointCoordinates      | updatePointCoordinates should execute UPDATE                            | pt-1, 50.5, 7.5                                                | SQL UPDATE exécuté                                                    | SQL UPDATE exécuté                                                    | Oui           |
| 63  | databaseAcces.test.ts         | deletePoint                 | deletePoint should execute DELETE                                       | pt-1                                                           | SQL DELETE exécuté                                                    | SQL DELETE exécuté                                                    | Oui           |
| 64  | TeamGuidanceScreen.test.tsx   | TeamGuidanceScreen          | should render loading state initially then display map and actions      | mockGetFirstSync, mockGetAllSync                               | Affichage "Chargement du guidage...", puis carte et actions           | Affichage "Chargement du guidage...", puis carte et actions           | Oui           |
| 65  | TeamGuidanceScreen.test.tsx   | TeamGuidanceScreen          | should fetch route from OSRM API                                        | global.fetch                                                   | Appel à l'API OSRM, route affichée                                    | Appel à l'API OSRM, route affichée                                    | Oui           |
| 66  | TeamGuidanceScreen.test.tsx   | TeamGuidanceScreen          | should handle empty actions (all done or no actions)                    | mockGetAllSync=[]                                              | Affichage "Toutes les actions terminées !"                            | Affichage "Toutes les actions terminées !"                            | Oui           |
| 67  | TeamGuidanceScreen.test.tsx   | TeamGuidanceScreen          | should fallback to direct coordinates if point coordinates missing      | mockGetAllSync, coords manquantes                              | Affichage action avec coordonnées directes                            | Affichage action avec coordonnées directes                            | Oui           |
| 68  | TeamGuidanceScreen.test.tsx   | TeamGuidanceScreen          | should detect proximity and allow validation via Alert                  | mockLocation, alertSpy, mockRunSync                            | Détection proximité, Alert, validation action                         | Détection proximité, Alert, validation action                         | Oui           |
| 69  | SettingsScreen.test.tsx       | SettingsScreen              | should render rendering current event and settings buttons              | mockEvents, mockSelectedEventId                                | Affichage event et boutons settings                                   | Affichage event et boutons settings                                   | Oui           |
| 70  | SettingsScreen.test.tsx       | SettingsScreen              | should open modal and allow changing event                              | fireEvent, mockSetSelectedEventId                              | Ouverture modale, changement event                                    | Ouverture modale, changement event                                    | Oui           |
| 71  | SettingsScreen.test.tsx       | SettingsScreen              | should handle "Receive" mode: open scanner                              | fireEvent                                                      | Affichage scanner QR                                                  | Affichage scanner QR                                                  | Oui           |
| 72  | SettingsScreen.test.tsx       | SettingsScreen              | should handle "Send" mode: open scanner and trigger delete on success   | fireEvent, mockRunSync, mockRefreshEvents                      | Suppression en cascade, rafraîchissement                              | Suppression en cascade, rafraîchissement                              | Oui           |
| 73  | SettingsScreen.test.tsx       | SettingsScreen              | should prevent sending if no event selected                             | mockSelectedEventId=null                                       | Bouton désactivé                                                      | Bouton désactivé                                                      | Oui           |
| 74  | App.test.tsx                  | App                         | s'affiche correctement et charge l'écran initial (ConnectEvent)         | -                                                              | Affichage écran ConnectEvent                                          | Affichage écran ConnectEvent                                          | Oui           |
| 75  | App.test.tsx                  | App                         | ne plante pas lors de l'initialisation                                  | -                                                              | Pas de crash, rendu non nul                                           | Pas de crash, rendu non nul                                           | Oui           |
